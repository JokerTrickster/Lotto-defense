# Lotto Defense - 메인 페이지 기획서

## 1. 개요

메인 페이지(로비)는 게임 진입 전 사용자가 상호작용하는 핵심 화면이다.
백엔드 API 개발 전 프론트엔드(Unity 클라이언트)를 먼저 구현하며,
로컬 데이터(PlayerPrefs/ScriptableObject)로 동작하도록 설계한다.

### 메인 페이지 구성 요소

| 기능 | 위치 | 설명 |
|------|------|------|
| 재화 표시 | 상단 좌측 바 | 골드, 입장권 잔여 수량 |
| 우편함 | 상단 우측 아이콘 | 운영자 공지 및 아이템 수령 |
| 구매 상점 | 상단 우측 아이콘 | 유닛 해금 (골드 소모) |
| 일일 보상 | 상단 우측 아이콘 | 게임 클리어 횟수 기반 보상 |
| 퀘스트 | 상단 우측 아이콘 | 미션 달성 시 골드/입장권 획득 |
| 게임 시작 | 하단 중앙 | 입장권 1장 소모하여 게임 진입 |

---

## 2. 재화 시스템

### 2.1 골드 (Gold)

- **획득처**: 디펜스 게임 클리어 보상, 퀘스트 보상, 우편함, 일일 보상
- **사용처**: 구매 상점에서 유닛 해금
- **게임 내 골드와의 관계**: 메인 페이지 골드와 게임 내 골드는 별개
  - 메인 페이지 골드: 유닛 해금용 (영구 재화)
  - 게임 내 골드: 소환/업그레이드용 (매 게임 초기화)

### 2.2 입장권 (Entry Ticket)

- **용도**: 게임 1회 플레이 시 1장 소모
- **획득처**:
  - 일일 보상 (게임 클리어 횟수 달성)
  - 퀘스트 보상
  - 우편함 (운영자 지급)
  - 현금 구매 (인앱결제, 향후 구현)
- **소모 시점**: 게임 시작 버튼 클릭 시 1장 차감
- **부족 시**: "입장권이 부족합니다" 팝업 + 획득 경로 안내

---

## 3. 우편함 (Mailbox)

### 3.1 기능 정의

운영자가 사용자에게 공지사항 전달 및 아이템을 지급하는 시스템.

### 3.2 우편 데이터 구조

```
Mail {
    id: string              // 고유 식별자
    title: string           // 제목
    body: string            // 본문 내용
    type: MailType          // Notice(공지) | Reward(보상)
    attachments: [           // 첨부 아이템 (0~N개)
        { itemType: "gold" | "ticket", amount: int }
    ]
    isRead: bool            // 읽음 여부
    isClaimed: bool         // 수령 여부 (보상 우편만)
    expiresAt: datetime     // 만료 시각 (null이면 무기한)
    createdAt: datetime     // 발송 시각
}
```

### 3.3 UI 흐름

1. 메인 페이지 우측 상단 우편함 아이콘 (미수령 우편 있으면 빨간 뱃지 표시)
2. 클릭 → 우편 목록 팝업 (최신순 정렬)
3. 우편 선택 → 상세 내용 표시
4. **공지(Notice)**: 읽기만 가능
5. **보상(Reward)**: "수령" 버튼 클릭 → 첨부 아이템 획득 → isClaimed = true
6. "전체 수령" 버튼: 모든 미수령 보상 우편 일괄 수령

### 3.4 프론트엔드 구현 (백엔드 없이)

- `MailConfig` ScriptableObject에 더미 우편 데이터 정의
- PlayerPrefs로 읽음/수령 상태 저장
- 향후 백엔드 연동 시 API 호출로 교체

---

## 4. 구매 상점 (Unit Shop)

### 4.1 기능 정의

골드를 사용하여 유닛을 **영구 해금**하는 상점.
해금된 유닛은 게임 내 소환(랜덤 뽑기) 풀에 포함된다.

### 4.2 해금과 소환의 관계

```
[상점에서 해금] → 소환 풀에 추가 → [게임 내 소환 버튼] → 해금된 유닛 중 랜덤 등장
```

- **초기 상태**: Warrior(전사)만 해금됨 (무료)
- **미해금 유닛**: 소환 풀에서 제외 → 게임 내에서 등장하지 않음
- **해금 후**: 소환 시 해당 유닛이 확률적으로 등장

### 4.3 상점 유닛 목록

| 유닛명 | 등급 | 해금 비용(골드) | 초기 상태 |
|--------|------|----------------|-----------|
| 전사 (Warrior) | Normal | 무료 | 해금됨 |
| 궁수 (Archer) | Rare | 100 | 잠금 |
| 마법사 (Mage) | Epic | 500 | 잠금 |
| 용기사 (Dragon Knight) | Legendary | 2000 | 잠금 |

> 유닛 추가 시 이 테이블 확장. 가격은 GameBalanceConfig에서 관리.

### 4.4 유닛 정보 표시

상점에서 유닛 카드 클릭 시 상세 정보 팝업:

```
┌─────────────────────────────────┐
│  [유닛 아이콘]                    │
│  궁수 (Archer)         ★★ Rare  │
│─────────────────────────────────│
│  공격력:    25                    │
│  공속:      1.5 /초              │
│  사거리:    3.0                   │
│  스킬:      이중 사격             │
│            - 공격 시 20% 확률로   │
│              2번 공격             │
│─────────────────────────────────│
│  조합 방법:                       │
│  전사 x2 → 궁수                  │
│─────────────────────────────────│
│  [ 해금 (100G) ]  or  [해금됨]   │
└─────────────────────────────────┘
```

### 4.5 UI 흐름

1. 메인 페이지 "상점" 버튼 클릭
2. 유닛 목록 그리드 표시 (카드 형태)
   - 해금된 유닛: 컬러 카드 + "보유중" 뱃지
   - 미해금 유닛: 흑백 카드 + 잠금 아이콘 + 가격 표시
3. 유닛 카드 클릭 → 상세 정보 팝업
4. "해금" 버튼 클릭 → 골드 차감 → 해금 완료 연출
5. 골드 부족 시 → "골드가 부족합니다" 팝업

---

## 5. 일일 보상 (Daily Rewards)

### 5.1 기능 정의

하루 동안의 게임 클리어 횟수에 따라 단계별 보상을 지급하는 시스템.
매일 자정(00:00) 초기화.

### 5.2 보상 단계

| 단계 | 조건 | 보상 |
|------|------|------|
| 1단계 | 1회 클리어 | 골드 50 |
| 2단계 | 3회 클리어 | 입장권 1장 |
| 3단계 | 5회 클리어 | 골드 150 |
| 4단계 | 10회 클리어 | 입장권 2장 + 골드 200 |

> 보상 수치는 향후 밸런스 조정 대상. GameBalanceConfig에서 관리.

### 5.3 UI 흐름

1. 메인 페이지 "일일 보상" 버튼 (수령 가능 시 알림 뱃지)
2. 클릭 → 보상 단계 프로그레스 바 표시
   - 달성한 단계: 밝은 색 + "수령" 버튼
   - 미달성 단계: 어두운 색 + 잔여 횟수 표시
   - 이미 수령한 단계: 체크 표시
3. "수령" 버튼 클릭 → 보상 획득 연출 → 재화 갱신

### 5.4 프론트엔드 구현 (백엔드 없이)

- PlayerPrefs에 저장:
  - `daily_clear_count`: 오늘 클리어 횟수
  - `daily_claimed_stages`: 수령한 단계 (비트마스크)
  - `daily_reset_date`: 마지막 초기화 날짜
- 앱 시작 시 날짜 비교 → 날짜 변경됐으면 초기화

---

## 6. 퀘스트 (Quests)

### 6.1 기능 정의

다양한 미션을 달성하여 골드 및 입장권을 획득하는 시스템.
기존 게임 내 히든 퀘스트와는 별개로, 메인 페이지에서 확인/수령하는 퀘스트.

### 6.2 퀘스트 유형

| 유형 | 예시 | 추적 방식 |
|------|------|-----------|
| 게임 클리어 | "게임 5회 클리어" | 누적 클리어 횟수 |
| 라운드 도달 | "20라운드 이상 도달 3회" | 게임 종료 시 기록 |
| 유닛 해금 | "유닛 3종 해금" | 상점 해금 시 추적 |
| 조합 달성 | "조합 10회 수행" | 게임 내 조합 시 누적 |
| 업그레이드 | "업그레이드 20회 수행" | 게임 내 업그레이드 시 누적 |

### 6.3 퀘스트 데이터 구조

```
Quest {
    id: string
    title: string           // "게임 5회 클리어"
    description: string     // 상세 설명
    type: QuestType         // GameClear, RoundReach, UnitUnlock, Synthesis, Upgrade
    targetCount: int        // 목표 횟수
    currentCount: int       // 현재 진행도
    rewards: [
        { itemType: "gold" | "ticket", amount: int }
    ]
    isClaimed: bool         // 수령 여부
    isDaily: bool           // 일일 퀘스트 여부 (true면 매일 초기화)
}
```

### 6.4 퀘스트 목록 (초기)

| ID | 제목 | 조건 | 보상 | 유형 |
|----|------|------|------|------|
| Q001 | 첫 승리 | 게임 1회 클리어 | 골드 100 | 영구 |
| Q002 | 견습 용사 | 게임 5회 클리어 | 입장권 2장 | 영구 |
| Q003 | 숙련된 지휘관 | 게임 20회 클리어 | 골드 500 | 영구 |
| Q004 | 수집가 | 유닛 전종 해금 | 입장권 5장 + 골드 1000 | 영구 |
| Q005 | 조합의 달인 | 조합 50회 수행 | 골드 300 | 영구 |
| Q006 | 일일: 오늘의 전투 | 게임 3회 클리어 | 골드 30 | 일일 |
| Q007 | 일일: 강화 훈련 | 업그레이드 5회 | 입장권 1장 | 일일 |

### 6.5 UI 흐름

1. 메인 페이지 "퀘스트" 버튼 (완료 가능 퀘스트 있으면 알림 뱃지)
2. 클릭 → 퀘스트 목록 팝업 (탭: 일일 | 영구)
3. 각 퀘스트: 제목 + 진행 바 + 보상 아이콘
4. 달성된 퀘스트: "수령" 버튼 활성화
5. 수령 클릭 → 보상 획득 연출 → 재화 갱신

---

## 7. 게임 시작 흐름

### 7.1 흐름도

```
[게임 시작 버튼 클릭]
    ↓
[입장권 >= 1 확인]
    ├─ NO → "입장권 부족" 팝업 (획득 경로 안내)
    └─ YES
        ↓
[입장권 1장 차감]
    ↓
[GameScene 로드]
    ↓
[기존 소환 시스템 (해금된 유닛만 소환 풀에 포함)]
    ↓
[게임 종료]
    ↓
[결과 정산]
    ├─ 클리어 보상: 메인 골드 지급
    ├─ 일일 보상 카운터 +1
    └─ 퀘스트 진행도 갱신
    ↓
[메인 페이지로 복귀]
```

### 7.2 게임 클리어 보상

| 결과 | 골드 보상 |
|------|-----------|
| 10라운드 미만 탈락 | 10 |
| 10~19라운드 탈락 | 30 |
| 20~29라운드 탈락 | 60 |
| 30라운드 클리어 | 100 |

---

## 8. 메인 페이지 UI 레이아웃

```
┌──────────────────────────────────────────────┐
│  💰1,250  🎟️3      [🎁] [🛒] [📋] [📬]     │  ← 상단 바
│──────────────────────────────────────────────│
│                                              │
│                                              │
│                                              │
│               LOTTO DEFENSE                  │  ← 타이틀/로고
│                                              │
│                                              │
│                                              │
│                                              │
│          ┌───────────────────┐               │
│          │   ⚔️ 게임 시작    │               │  ← 게임 시작 버튼
│          │   (입장권 1장)     │               │
│          └───────────────────┘               │
│                                              │
│  [설정⚙️]                        [로그아웃]   │  ← 하단 유틸리티
└──────────────────────────────────────────────┘

상단 우측 아이콘 (좌→우):
  🎁 일일보상  - 수령 가능 시 빨간 뱃지
  🛒 구매상점  - 신규 해금 가능 시 뱃지
  📋 퀘스트    - 달성 퀘스트 있으면 뱃지
  📬 우편함    - 미수령 우편 있으면 뱃지
```

### 상단 바 상세

| 요소 | 위치 | 크기 | 비고 |
|------|------|------|------|
| 골드 | 좌측 | 아이콘+텍스트 | 💰 아이콘 + 숫자 |
| 입장권 | 골드 우측 | 아이콘+텍스트 | 🎟️ 아이콘 + 숫자 |
| 일일보상 | 우측 첫번째 | 44x44 아이콘 | 알림 뱃지 지원 |
| 구매상점 | 우측 두번째 | 44x44 아이콘 | 알림 뱃지 지원 |
| 퀘스트 | 우측 세번째 | 44x44 아이콘 | 알림 뱃지 지원 |
| 우편함 | 우측 네번째 | 44x44 아이콘 | 알림 뱃지 지원 |

> 아이콘 크기 44x44px은 모바일 최소 터치 타겟(44pt) 기준.
> 아이콘 간 간격 8px, 상단 바 높이 60px.

---

## 9. 데이터 저장 전략 (프론트엔드 전용)

백엔드 없이 프론트에서만 동작하도록 로컬 저장.

### PlayerPrefs 키

| 키 | 타입 | 설명 |
|----|------|------|
| `lobby_gold` | int | 메인 페이지 골드 |
| `entry_tickets` | int | 입장권 수량 |
| `unlocked_units` | string | 해금된 유닛 목록 (JSON 배열) |
| `mail_read_{id}` | int (0/1) | 우편 읽음 상태 |
| `mail_claimed_{id}` | int (0/1) | 우편 수령 상태 |
| `daily_clear_count` | int | 오늘 클리어 횟수 |
| `daily_claimed_stages` | int | 일일 보상 수령 비트마스크 |
| `daily_reset_date` | string | 마지막 초기화 날짜 (yyyy-MM-dd) |
| `quest_progress_{id}` | int | 퀘스트 진행도 |
| `quest_claimed_{id}` | int (0/1) | 퀘스트 수령 상태 |
| `total_clears` | int | 누적 클리어 횟수 |
| `total_synthesis` | int | 누적 조합 횟수 |
| `total_upgrades` | int | 누적 업그레이드 횟수 |

### 향후 백엔드 전환 시

PlayerPrefs 접근을 래핑하는 `LobbyDataManager` 클래스를 만들어,
향후 API 호출로 교체할 수 있도록 인터페이스를 분리한다.

```csharp
// 프론트 전용
ILobbyData → LocalLobbyData (PlayerPrefs)

// 백엔드 연동 시
ILobbyData → RemoteLobbyData (REST API)
```

---

## 10. 구현 우선순위

| 순서 | 기능 | 의존성 | 난이도 |
|------|------|--------|--------|
| 1 | 재화 시스템 (LobbyDataManager) | 없음 | 낮음 |
| 2 | 상단 재화 표시 바 | 재화 시스템 | 낮음 |
| 3 | 구매 상점 (유닛 해금) | 재화 시스템 | 중간 |
| 4 | 게임 시작 (입장권 차감) | 재화 시스템 | 낮음 |
| 5 | 게임 결과 정산 | 재화 시스템 | 중간 |
| 6 | 소환 풀 필터링 (해금된 유닛만) | 구매 상점 | 중간 |
| 7 | 일일 보상 | 재화 시스템 + 게임 결과 | 중간 |
| 8 | 퀘스트 | 재화 시스템 + 게임 결과 | 높음 |
| 9 | 우편함 | 재화 시스템 | 중간 |

---

## 11. 미결 사항

| 항목 | 질문 | 기본값 (임시) |
|------|------|--------------|
| 초기 입장권 수 | 신규 유저에게 몇 장 지급? | 5장 |
| 골드 초기값 | 신규 유저 시작 골드? | 0 (첫 게임은 입장권으로 바로 진입) |
| 인앱결제 | 입장권 외 골드도 구매 가능? | 향후 결정 |
| 유닛 추가 | 향후 유닛 종류 확장 계획? | 현재 4종으로 시작 |
| 일일 퀘스트 초기화 | 서버 시간 기준 vs 로컬 시간? | 로컬 시간 (프론트 전용) |
| 게임 내 골드 → 메인 골드 | 게임 내 남은 골드를 메인으로 전환? | 아니오 (클리어 보상만) |
