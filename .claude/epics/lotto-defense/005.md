---
id: "005"
title: "Monster Spawning & Movement"
status: "todo"
priority: "high"
estimate: "16h"
tags: ["monsters", "spawning", "movement", "pooling"]
dependencies: ["002"]
parallel: true
created: "2025-10-28T02:12:15Z"
updated: "2025-10-28T02:12:15Z"
---

# Task 005: Monster Spawning & Movement

## Overview
Implement monster spawning system with waypoint-based movement along predefined paths. Create object pooling for efficient monster management and spawn 2 monsters per second from top and bottom lanes.

## Objectives
- Create MonsterManager with timed spawning
- Implement waypoint-based movement system
- Build object pooling for 20 monsters
- Create 3-5 MonsterData ScriptableObjects
- Integrate with grid path system

## Technical Specifications

### Namespace
`LottoDefense.Monsters`

### Files to Create
- `Assets/Scripts/Monsters/MonsterData.cs` - ScriptableObject definition
- `Assets/Scripts/Monsters/MonsterManager.cs` - Spawn control and lifecycle
- `Assets/Scripts/Monsters/Monster.cs` - Individual monster behavior
- `Assets/Scripts/Monsters/MonsterPool.cs` - Object pooling system
- `Assets/Data/Monsters/` - Directory for 3-5 ScriptableObject assets

### MonsterData Properties
```csharp
// ScriptableObject fields
- string monsterName
- int maxHealth
- int currentHealth
- int attack
- int defense
- float moveSpeed
- int goldReward
- Sprite sprite
- GameObject prefab
- MonsterType type (enum: Normal, Fast, Tank, Boss)
```

### MonsterManager Responsibilities
1. **Spawn System:**
   - Spawn rate: 2 monsters/second
   - Alternate between top path and bottom path
   - Coroutine-based timed spawning
   - Wave system (future: increase difficulty)

2. **Monster Lifecycle:**
   - SpawnMonster(MonsterData, PathType)
   - OnMonsterDeath(Monster)
   - OnMonsterReachEnd(Monster)
   - DestroyMonster(Monster)

3. **Integration:**
   - Reference to GridManager for path waypoints
   - Reference to GameManager for gold rewards
   - Event system (OnMonsterSpawned, OnMonsterDied)

### Monster Behavior
```csharp
// Monster.cs responsibilities
- Initialize(MonsterData, List<Vector3> waypoints)
- Move() - Follow waypoint path
- TakeDamage(int damage)
- Die() - Award gold, trigger effects
- ReachEnd() - Decrease monster counter, remove

// Movement logic
- Current waypoint index
- MoveTowards current waypoint
- OnWaypointReached: Move to next
- OnFinalWaypointReached: ReachEnd()
```

### Object Pooling System
```csharp
// MonsterPool.cs
- Pool capacity: 20 monsters
- GetMonster(MonsterData) → Monster
- ReturnMonster(Monster)
- PrewarmPool() - Initialize on start
- ExpandPool() - If needed at runtime

// Pooling benefits:
- Reduce Instantiate/Destroy overhead
- Smooth performance with 2/sec spawn rate
- Reuse GameObjects efficiently
```

### Path System Integration
```csharp
// From GridManager
- GetTopPathWaypoints() → List<Vector3>
- GetBottomPathWaypoints() → List<Vector3>

// Waypoint format
- List of world positions
- Straight line from top/bottom to opposite end
- Monsters follow in order
```

### Spawn Logic
```csharp
// Coroutine: SpawnRoutine()
while (gameActive) {
    yield return new WaitForSeconds(0.5f); // 2 per second

    MonsterData data = SelectRandomMonster();
    PathType path = alternatePathFlag ? PathType.Top : PathType.Bottom;
    SpawnMonster(data, path);

    alternatePathFlag = !alternatePathFlag;
}
```

## Implementation Steps
1. Create MonsterData ScriptableObject class
2. Implement Monster class with waypoint movement
3. Build MonsterPool for object pooling
4. Create MonsterManager with spawn coroutine
5. Generate 3-5 MonsterData assets in Unity Editor
6. Integrate with GridManager for waypoints
7. Test spawn rate and path following
8. Implement death and end-reach logic

## Testing Requirements
- Verify spawn rate: 2 monsters/second
- Test alternating path spawning
- Validate waypoint following accuracy
- Test object pooling (reuse after death)
- Confirm gold rewards on monster death
- Test monster counter decrease on reach end
- Verify performance with 20 active monsters
- Edge case: Pool expansion if >20 monsters

## Dependencies
- **Depends on:** Task 002 (Grid system with path waypoints)
- **Parallel work:** Independent from unit system (Tasks 003, 004)
- **No conflicts:** Separate namespace and systems

## Acceptance Criteria
- [ ] MonsterManager spawns 2 monsters/second
- [ ] Monsters alternate between top/bottom paths
- [ ] Waypoint-based movement follows paths accurately
- [ ] Object pool manages 20 monsters efficiently
- [ ] 3-5 MonsterData ScriptableObjects created
- [ ] Monsters award gold on death
- [ ] Monster counter decreases when reaching end
- [ ] Pool reuses GameObjects correctly
- [ ] No performance issues with continuous spawning
- [ ] Smooth movement along waypoints

## Notes
- Consider adding monster spawn animations
- Future: Wave system with increasing difficulty
- Future: Special monster abilities
- Future: Boss monsters at wave milestones
- Use Unity's Vector3.MoveTowards for smooth movement
- Consider NavMesh for more complex paths (overkill for straight lines)
