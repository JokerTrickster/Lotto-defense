---
id: "003"
title: "Unit Data & Gacha System"
status: "todo"
priority: "high"
estimate: "8h"
tags: ["units", "gacha", "core-system"]
dependencies: ["002"]
parallel: true
created: "2025-10-28T02:12:15Z"
updated: "2025-10-28T02:12:15Z"
---

# Task 003: Unit Data & Gacha System

## Overview
Implement the unit data structure and gacha system for random unit acquisition. Create 12 unit variants across 3 types and 4 rarity tiers with weighted probability gacha mechanics.

## Objectives
- Create UnitData ScriptableObject system
- Implement UnitManager with weighted gacha
- Add unit draw button with gold cost validation
- Build unit inventory management

## Technical Specifications

### Namespace
`LottoDefense.Units`

### Files to Create
- `Assets/Scripts/Units/UnitData.cs` - ScriptableObject definition
- `Assets/Scripts/Units/UnitManager.cs` - Gacha and inventory logic
- `Assets/Scripts/Units/Unit.cs` - Unit instance behavior
- `Assets/Scripts/Units/MeleeUnit.cs` - Melee type implementation
- `Assets/Scripts/Units/RangedUnit.cs` - Ranged type implementation
- `Assets/Scripts/Units/DebufferUnit.cs` - Debuffer type implementation
- `Assets/Data/Units/` - Directory for 12 ScriptableObject assets

### Unit Types & Rarities
**3 Unit Types:**
1. Melee - Close combat units
2. Ranged - Distance attack units
3. Debuffer - Support/debuff units

**4 Rarity Tiers:**
- Normal (50% drop rate)
- Rare (30% drop rate)
- Epic (15% drop rate)
- Legendary (5% drop rate)

**Total: 3 types × 4 rarities = 12 UnitData assets**

### UnitData Properties
```csharp
// ScriptableObject fields
- string unitName
- UnitType type (enum: Melee, Ranged, Debuffer)
- UnitRarity rarity (enum: Normal, Rare, Epic, Legendary)
- int attack
- int defense
- float attackRange
- float attackSpeed
- Sprite icon
- GameObject prefab
```

### UnitManager Responsibilities
1. **Gacha System:**
   - Weighted random selection (50/30/15/5)
   - DrawUnit() method with 5 gold cost check
   - Return UnitData on successful draw

2. **Inventory Management:**
   - List<UnitData> inventory
   - AddUnit(UnitData)
   - RemoveUnit(UnitData)
   - GetInventory() → List<UnitData>

3. **Integration:**
   - Reference to GameManager for gold checking
   - Event system for UI updates (OnUnitDrawn, OnInventoryChanged)

### UI Requirements
- Unit draw button
  - Gold cost display (5 gold)
  - Disabled state when gold < 5
  - Visual feedback on successful draw
  - Show acquired unit info popup

## Implementation Steps
1. Create UnitData ScriptableObject class
2. Implement UnitManager singleton with gacha logic
3. Create base Unit class and type-specific subclasses
4. Generate 12 UnitData assets in Unity Editor
5. Implement unit draw button and inventory UI
6. Add gold validation and event notifications
7. Test weighted probability distribution

## Testing Requirements
- Verify gacha probability distribution (50/30/15/5)
- Test gold cost validation
- Confirm inventory operations (add/remove)
- Validate all 12 unit data assets load correctly
- Test UI state management (button enable/disable)

## Dependencies
- **Depends on:** Task 002 (GameManager with gold system)
- **Parallel work:** Can work alongside Task 004 (placement system)
- **Conflict warning:** Both 003 and 004 modify UnitManager - coordinate changes

## Acceptance Criteria
- [ ] 12 UnitData ScriptableObjects created and configured
- [ ] UnitManager implements weighted gacha (50/30/15/5)
- [ ] Unit draw costs 5 gold and validates balance
- [ ] Inventory system stores and retrieves units
- [ ] UI button reflects gold availability
- [ ] Events notify UI of inventory changes
- [ ] All unit types have proper implementations
- [ ] Gacha probability tested and confirmed accurate

## Notes
- Consider adding unit preview functionality
- Future: Implement multi-draw with discount
- Future: Add pity system for legendary units
- Keep ScriptableObject data immutable at runtime
