---
name: Grid System & UI Layout
status: open
created: 2025-10-28T02:12:15Z
updated: 2025-10-28T02:12:15Z
github:
depends_on: [001]
parallel: false
conflicts_with: []
---

## Description

Implement the 6x10 grid system optimized for portrait orientation (9:16 aspect ratio) that serves as the battlefield for unit placement and monster movement. Create the game HUD displaying 6 critical stats: round number, remaining time, monster count, gold, unit count, and life. The grid must handle cell selection, visual feedback, and provide a clean API for unit placement.

## Acceptance Criteria

- [ ] GridManager generates 6 columns × 10 rows grid (60 cells total)
- [ ] Grid cells have visual borders and hover/selection highlights
- [ ] Cell selection system supports single-select with visual feedback
- [ ] World-space to grid coordinate conversion (Vector3 ↔ Vector2Int)
- [ ] Query system: `IsOccupied(x, y)`, `GetCellAt(x, y)`, `GetNeighbors(x, y)`
- [ ] HUD displays 6 stats: Round, Time, Monsters, Gold, Units, Life
- [ ] HUD updates in real-time when game values change
- [ ] Grid scales appropriately for different screen resolutions
- [ ] Clean separation between grid logic and visual representation

## Technical Details

### Namespace
- `LottoDefense.Grid` for grid management
- `LottoDefense.UI` for HUD components

### Files to Create/Modify

1. **Assets/Scripts/Grid/GridCell.cs**
   ```csharp
   namespace LottoDefense.Grid
   {
       public class GridCell : MonoBehaviour
       {
           public Vector2Int Coordinates { get; set; }
           public bool IsOccupied { get; set; }
           public GameObject OccupyingUnit { get; set; }

           // Visual states: Normal, Hover, Selected, Invalid
           public void SetVisualState(CellState state);
           public void Highlight(Color color);
           public void ResetHighlight();
       }
   }
   ```

2. **Assets/Scripts/Grid/GridManager.cs**
   - Singleton instance
   - Constants: `GRID_WIDTH = 6`, `GRID_HEIGHT = 10`
   - Properties: `CellSize`, `GridOrigin`
   - Methods:
     - `GenerateGrid()` - Create grid cell objects
     - `WorldToGrid(Vector3 worldPos)` - Convert coordinates
     - `GridToWorld(Vector2Int gridPos)` - Convert coordinates
     - `GetCellAt(int x, int y)` - Query cell
     - `GetNeighbors(Vector2Int pos, bool includeDiagonal = false)` - Adjacent cells
     - `IsValidPosition(int x, int y)` - Bounds check
     - `IsOccupied(int x, int y)` - Occupancy check
     - `SelectCell(Vector2Int pos)` - Handle selection
     - `DeselectAll()` - Clear selection
   - Events:
     - `OnCellSelected(Vector2Int position)`
     - `OnCellDeselected(Vector2Int position)`

3. **Assets/Scripts/Grid/CellState.cs**
   ```csharp
   namespace LottoDefense.Grid
   {
       public enum CellState
       {
           Normal,
           Hover,
           Selected,
           Invalid,
           Occupied
       }
   }
   ```

4. **Assets/Scripts/UI/GameHUD.cs**
   - References to TextMeshProUGUI components for each stat
   - Methods:
     - `UpdateRound(int round)`
     - `UpdateTime(float seconds)`
     - `UpdateMonsterCount(int count)`
     - `UpdateGold(int gold)`
     - `UpdateUnitCount(int count)`
     - `UpdateLife(int life)`
   - Subscribe to GameplayManager.OnGameValueChanged event
   - Format time as MM:SS

5. **GameScene.unity**
   - Create empty GameObject "GridManager" with GridManager component
   - Create Canvas/HUD hierarchy:
     ```
     Canvas
     └── HUD
         ├── RoundText (TMP)
         ├── TimeText (TMP)
         ├── MonsterText (TMP)
         ├── GoldText (TMP)
         ├── UnitText (TMP)
         └── LifeText (TMP)
     ```
   - Grid cell prefab with SpriteRenderer and BoxCollider2D

### Grid Layout Specifications

**Portrait Orientation (9:16 aspect ratio)**
- Grid positioned in center-bottom of screen
- Leave top 20% for HUD
- Cell size calculated dynamically: `screenWidth * 0.95 / 6`
- Grid origin: `(screenWidth/2 - gridWidth/2, screenHeight * 0.1)`

**Visual Design**
- Cell border: 2px white outline
- Normal state: Semi-transparent white (0.2 alpha)
- Hover state: Yellow tint (0.4 alpha)
- Selected state: Green tint (0.6 alpha)
- Invalid state: Red tint (0.4 alpha)
- Occupied state: Blue tint (0.3 alpha)

**HUD Layout**
- Position: Top of screen, centered
- 2 rows × 3 columns grid layout
- Icon + Label + Value for each stat
- Format examples:
  - Round: "Round: 1"
  - Time: "Time: 01:30"
  - Monsters: "Monsters: 5"
  - Gold: "Gold: 50"
  - Units: "Units: 3"
  - Life: "Life: 10"

### Grid Data Structure
```csharp
private GridCell[,] gridCells = new GridCell[GRID_WIDTH, GRID_HEIGHT];
private Vector2Int? selectedCell = null;
```

## Dependencies

### External Dependencies
- TextMeshPro for HUD text
- Unity UI system (Canvas, Layout Groups)

### Internal Dependencies
- **Task 001**: GameplayManager for game value synchronization
- Requires GameplayManager.OnGameValueChanged events

## Effort Estimate

**Total: 1 day (8 hours)**

Breakdown:
- GridManager core logic: 2 hours
- GridCell visual states and interaction: 2 hours
- HUD layout and component setup: 1.5 hours
- Coordinate conversion and query system: 1.5 hours
- Testing and resolution scaling: 1 hour

## Definition of Done

- [ ] All acceptance criteria met
- [ ] Grid generates correctly in portrait mode on multiple resolutions
- [ ] Cell selection works with mouse/touch input
- [ ] Visual feedback responds immediately to interaction
- [ ] HUD updates when GameplayManager values change
- [ ] No errors in Unity console
- [ ] Grid coordinate system tested with unit tests for conversion accuracy
- [ ] Neighbor query returns correct adjacent cells
- [ ] Grid scales properly on 9:16, 9:18, and 9:19.5 aspect ratios
- [ ] Code follows Unity C# conventions and namespace structure
- [ ] XML documentation comments added for public APIs
- [ ] Manual testing: place imaginary units on grid, verify occupancy checks
- [ ] Performance: Grid generation completes in <100ms
